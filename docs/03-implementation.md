# 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ MVP –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

- [x] Bot skeleton (Telegraf)
- [x] Whitelist logic + —Ä–µ–∂–∏–º DISABLE_WHITELIST –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [x] Persistence (SQLite, better-sqlite3)
- [x] Users —Å —Ä–æ–ª—è–º–∏ OWNER / PARTNER
- [x] Add wish flow (FSM)
- [x] Add date flow (FSM: title ‚Üí date ‚Üí type ‚Üí remind_before)
- [x] Cron: date reminders (09:00), random reminders (12:00)
- [x] Error handling + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- [x] **TypeScript** ‚Äî –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å —Ç–∏–ø–∞–º–∏
- [x] **–í—ã–±–æ—Ä —Ä–æ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ** ‚Äî –¥–ª—è –Ω–µ-owner –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ü–µ–Ω–∞ ¬´–ö—Ç–æ –≤—ã –≤ –ø–∞—Ä–µ?¬ª
- [x] **Reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** ‚Äî –ø–ª–∞—à–∫–∏ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ (–ì–ª–∞–≤–Ω–∞—è, –ü–æ–º–æ—â—å, –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –∏ —Ç.–¥.)
- [x] **–¢–æ–Ω –ø–æ–¥ –ø–∞—Ä—É** ‚Äî ¬´—Ç–≤–æ—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞¬ª, ¬´–≤–∞—Å –¥–≤–æ–∏—Ö¬ª, ¬´–≥–æ–¥–æ–≤—â–∏–Ω–∞, –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è¬ª
- [x] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî `src/logger.ts`, DEBUG —á–µ—Ä–µ–∑ env
- [x] **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏** ‚Äî –µ—Å–ª–∏ –≤ –ë–î –∑–∞–ø–∏—Å–∞–Ω OWNER, –Ω–æ telegram_id ‚â† OWNER_ID, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä —Ä–æ–ª–∏

### –°—Ü–µ–Ω—ã (FSM)

| –°—Ü–µ–Ω–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `ADD_WISH` | –í–≤–æ–¥ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º |
| `ADD_DATE` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã: title ‚Üí date ‚Üí yearly/once ‚Üí remind_before_days |
| `SELECT_ROLE` | –í—ã–±–æ—Ä —Ä–æ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ (—Ç–æ–ª—å–∫–æ PARTNER) |

### –ö–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏

–ö–æ–º–∞–Ω–¥—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ (bot.hears). –ü—Ä–∏–º–µ—Ä—ã: `BTN.MAIN` ‚Üí ¬´üè† –ì–ª–∞–≤–Ω–∞—è¬ª, `BTN.ADD_DATE` ‚Üí ¬´üìÖ –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É¬ª.

## –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **SQLite** ‚Äî –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ë–î, —Ñ–∞–π–ª `./data/relationship_bot.db`
2. **–†–æ–ª–∏** ‚Äî OWNER –ø–æ OWNER_ID, PARTNER —á–µ—Ä–µ–∑ –≤—ã–±–æ—Ä –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ –∏–ª–∏ –ø–æ PARTNER_ID
3. **–ó–∞–≥—Ä—É–∑–∫–∞ .env** ‚Äî `src/loadEnv.ts` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º (–¥–æ config)
4. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –≤ selectRoleScene –ø—Ä–æ–≤–µ—Ä–∫–∞ `rolePromptSentAt` (< 3 —Å–µ–∫)
5. **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å cron** ‚Äî `Europe/Moscow`

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –û–¥–Ω–∞ –ø–∞—Ä–∞: –æ–¥–∏–Ω OWNER, –æ–¥–∏–Ω PARTNER (–ø–æ –ª–æ–≥–∏–∫–µ whitelist)
- –ù–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –¥–∞—Ç/–∑–∞–º–µ—Ç–æ–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- Inline-–∫–Ω–æ–ø–∫–∏ –≤ addDate (yearly/once) ‚Äî callback_data
